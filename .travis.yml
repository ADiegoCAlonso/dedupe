branches:
  only:
  - master
  - development
language: python
notifications:
  email:
    on_success: change
    on_failure: always
  irc: chat.freenode.net#dedupe
matrix:
  include:
    - os: linux
      python: 3.4
    - os: linux
      python: 2.7
    - os: osx
      language: generic
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then git clone https://github.com/MacPython/terryfy ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source terryfy/travis_tools.sh ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then get_python_environment macpython 2.7.10 ; fi
install:
- pip install numpy>=1.9.2
- pip install --upgrade -r requirements.txt
- pip install coveralls
- cython src/*.pyx
- pip install -e .
script:
- coverage run -m nose
- python tests/canonical.py -vv
after_success: coveralls
deploy:
  provider: pypi
  user: fgregg
  password:
    secure: O/EwutOV8DmlYJ7dPJ2st7nGDKEaTaA/gwx7mxzFQYYlyJ7Iu87QXwEY3gPGFOGDh6eyg2qMqtKPTJnXTnltb8ROFX61WKu3F/do1cORFPDQneOAzyzL7ID+a7RaMaeUQ1gRFDo5nJuGGW8wmC8LZUjwcrtrx2zlYcEydq1CW+A=
  on:
    tags: true
    all_branches: true
    repo: datamade/dedupe
sudo: false
cache: pip
