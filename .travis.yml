branches:
  only:
  - master
  - "/^v.*$/"
language: python
notifications:
  email:
    on_success: change
    on_failure: always
  irc: chat.freenode.net#dedupe
matrix:
  include:
  - os: linux
    python: 3.4
  - os: linux
    python: 2.7
  - os: osx
    language: generic
    env: TERRYFY_PYTHON='system 2'
  - os: osx
    language: generic
    env: TERRYFY_PYTHON='homebrew 2'
  - os: osx
    language: generic
    env: TERRYFY_PYTHON='homebrew 3'
before_install:
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then git clone https://github.com/MacPython/terryfy;
  fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source terryfy/travis_tools.sh; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then get_python_environment $TERRYFY_PYTHON
  venv; fi
- if [[ "$TERRYFY_PYTHON" == "homebrew 3" ]]; then alias pip=`which pip3` ; fi
install:
- pip install numpy>=1.9.2
- pip install --upgrade -r requirements.txt
- pip install coveralls
- cython src/*.pyx
- pip install -e .
script:
- coverage run -m nose
- python tests/canonical.py -vv
after_success: coveralls
before_deploy:
  pip install twine
deploy:
  provider: pypi
  user: fgregg
  password:
    secure: eYGYv4qdMdB/s+EAaREMmaZSWZzzDFGMD6BgR5dNm730f5851yXOKbtGdUXMQUtsxHjVCk8s5M98kHNZFIS3sjbyKSvJH4iBeu448SFkl/Bk32bwSmKTRLO/8B5y5p3axAA32bsVEEo2ZIn2jT1JmATxMYxPZphg7GscO5kVX+Y=
  on:
    tags: true
    distributions: sdist bdist_wheel
    repo: datamade/dedupe
sudo: false
cache: pip
